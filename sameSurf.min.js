(function (options) { 'use strict'; if (!options || !options.apiKey || !options.apiSecret) { var code = '<script> \n \t sameSurf = { \n \t\t fullScreen: true, \n \t\t jsrsAsignUrl: "jsrsasign-all-min.js", \n \t\t startUrl: "YOURSTARTURL", \n \t\t apiKey: "YOURKEY", \n \t\t apiSecret: "YOURSECRET" \n \t }; \n </script> \n '; console.error('Missing SameSurf api key or api secret. Please include the following code before this file. \n' + code); return false } if (!window.KJUR && !options.jsrsAsignUrl) { console.error('RSA-Sign not found, download and install "jsrsasign-all-min.js" from https://github.com/kjur/jsrsasign and supply a link in options to jsrsAsignUrl'); return false } var APP = {}; var $head = document.getElementsByTagName('head')[0], iframe, loader, styles; APP.coBrowseStart = function () { if (options.fullScreen) { APP.createLoader(); APP.createStyles() } if (window.KJUR) { APP.roomCreate() } else { var script = document.createElement('script'); script.src = options.jsrsAsignUrl; script.async = true; script.onload = function () { APP.roomCreate() }; script.onerror = function () { alert('Error loading screenshare. JsrsAsign not found.') }; document.head.appendChild(script) } }; APP.coBrowseEnd = function () { if (loader) { loader.remove() } if (iframe) { iframe.remove() } }; APP.roomCreate = function () { var token_body = { iat: Math.floor(new Date().getTime() / 1000), sub: options.apiSecret }; var token = window.KJUR.jws.JWS.sign('HS256', { typ: 'JWT' }, token_body, options.apiKey); var data = {}; if (options.startUrl) { data.starturl = options.startUrl } var xhr = new XMLHttpRequest(); xhr.open('POST', 'https://api.samesurf.com/api/v3/create'); xhr.setRequestHeader('Content-Type', 'application/json'); xhr.setRequestHeader('Content-Type', 'application/json'); xhr.setRequestHeader('Authorization', 'Bearer ' + token); xhr.onload = function () { if (xhr.status === 200) { var data = JSON.parse(xhr.responseText); if (options.fullScreen) { APP.createIframe(data.privateinvitation) } else { window.location.replace(data.privateinvitation) } } else { alert('Error attempting to start screenshare: ' + xhr.statusText); console.error(xhr); APP.coBrowseEnd() } }; xhr.send(JSON.stringify(data)) }; APP.createLoader = function () { loader = document.createElement('div'); loader.innerHTML = '<div class="samesurf-loader"><div></div><div></div><div></div></div> <div class="samesurf-loading">Loading screenshare, please stand by...</div>'; loader.style.backgroundColor = '#fff'; loader.style.position = 'fixed'; loader.style.top = '0px'; loader.style.right = '0px'; loader.style.bottom = '0px'; loader.style.left = '0px'; loader.style.zIndex = 9998; loader.style.textAlign = 'center'; loader.style.paddingTop = '42vh'; loader.width = '100%'; loader.height = '100%'; document.getElementsByTagName('body')[0].appendChild(loader) }; APP.createStyles = function () { if (!styles) { styles = document.createElement('style'); styles.type = 'text/css'; var css = '.samesurf-loader{display:inline-block;position:relative;width:64px;height:64px}.samesurf-loader div{display:inline-block;position:absolute;left:6px;width:13px;background:#949494;animation:samesurf-loader 1.2s cubic-bezier(0,.5,.5,1) infinite}.samesurf-loader div:nth-child(1){left:6px;animation-delay:-.24s}.samesurf-loader div:nth-child(2){left:26px;animation-delay:-.12s}.samesurf-loader div:nth-child(3){left:45px;animation-delay:0}@keyframes samesurf-loader{0%{top:6px;height:51px}100%,50%{top:19px;height:26px}}'; if (styles.styleSheet) { styles.styleSheet.cssText = css } else { styles.appendChild(document.createTextNode(css)) } $head.append(styles) } }; APP.createIframe = function (url) { iframe = document.createElement('iframe'); iframe.id = 'sameSurfIframe'; iframe.frameBorder = 0; iframe.style.position = 'fixed'; iframe.style.top = '0px'; iframe.style.right = '0px'; iframe.style.bottom = '0px'; iframe.style.left = '0px'; iframe.style.zIndex = 9999; iframe.width = '100%'; iframe.height = '100%'; iframe.setAttribute('src', url); document.getElementsByTagName('body')[0].appendChild(iframe) }; APP.messageReceived = function (e) { console.log('Message Received', e); if (e.origin === 'https://realtime.samesurf.com') { var message = e.data; switch (message.type) { case 'storage_update': break; case 'user_gone': break; case 'user_logout': APP.coBrowseEnd(); break } } else { console.warn('Message response from unapproved source') } }; APP.pageLoaded = function () { document.getElementById('coBrowseStart').addEventListener('click', APP.coBrowseStart, false); document.getElementById('testMessaging').addEventListener('click', function () { window.parent.postMessage('Hello World', window.location.origin) }, false); window.addEventListener('message', APP.messageReceived, false) }; if (document.readyState === 'loading') { window.document.addEventListener('DOMContentLoaded', APP.pageLoaded, false) } else { APP.pageLoaded(); } })(window.sameSurfOptions || null);
