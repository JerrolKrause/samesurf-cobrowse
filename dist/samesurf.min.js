"use strict"; var SameSurf = (function () { function SameSurf() { this.options = window.sameSurfOptions; if (document.readyState === 'loading') { window.document.addEventListener('DOMContentLoaded', this.pageLoaded.bind(this), false) } else { this.pageLoaded(); } } SameSurf.prototype.coBrowseStart = function () { var _this = this; if (this.options.fullScreen) { this.createLoader(); this.createStyles() } if (window.KJUR) { this.roomCreate() } else { var script = document.createElement('script'); script.src = this.options.jsrsAsignUrl; script.async = true; script.onload = function () { _this.roomCreate() }; script.onerror = function () { alert('Error loading screenshare. JsrsAsign not found.'); _this.coBrowseEnd() }; document.head.appendChild(script) } };; SameSurf.prototype.coBrowseEnd = function () { if (this.loader) { this.loader.remove() } if (this.iframe) { this.iframe.remove() } };; SameSurf.prototype.roomCreate = function () { var _this = this; var token_body = { iat: Math.floor(new Date().getTime() / 1000), sub: this.options.apiSecret }; var token = window.KJUR.jws.JWS.sign('HS256', { typ: 'JWT' }, token_body, this.options.apiKey); var data = {}; if (this.options.startUrl) { data.starturl = this.options.startUrl } var xhr = new XMLHttpRequest(); xhr.open('POST', 'https://api.samesurf.com/api/v3/create'); xhr.setRequestHeader('Content-Type', 'application/json'); xhr.setRequestHeader('Content-Type', 'application/json'); xhr.setRequestHeader('Authorization', 'Bearer ' + token); xhr.onload = function () { if (xhr.status === 200) { var data = JSON.parse(xhr.responseText); if (_this.options.fullScreen) { _this.createIframe(data.privateinvitation) } else { window.location.replace(data.privateinvitation) } } else { alert('Error attempting to start screenshare: ' + xhr.statusText); console.error(xhr); _this.coBrowseEnd() } }; xhr.send(JSON.stringify(data)) };; SameSurf.prototype.createLoader = function () { var loader = document.createElement('div'); loader.innerHTML = '<div class="samesurf-loader"><div></div><div></div><div></div></div> <div class="samesurf-loading">Loading screenshare, please stand by...</div>'; loader.style.backgroundColor = '#fff'; loader.style.position = 'fixed'; loader.style.top = '0px'; loader.style.right = '0px'; loader.style.bottom = '0px'; loader.style.left = '0px'; loader.style.zIndex = '9998'; loader.style.textAlign = 'center'; loader.style.paddingTop = '42vh'; loader.style.width = '100%'; loader.style.height = '100%'; document.getElementsByTagName('body')[0].appendChild(loader); this.loader = loader };; SameSurf.prototype.createStyles = function () { if (!this.styles) { var styles = document.createElement('style'); styles.type = 'text/css'; var css = '.samesurf-loader{display:inline-block;position:relative;width:64px;height:64px}.samesurf-loader div{display:inline-block;position:absolute;left:6px;width:13px;background:#949494;animation:samesurf-loader 1.2s cubic-bezier(0,.5,.5,1) infinite}.samesurf-loader div:nth-child(1){left:6px;animation-delay:-.24s}.samesurf-loader div:nth-child(2){left:26px;animation-delay:-.12s}.samesurf-loader div:nth-child(3){left:45px;animation-delay:0}@keyframes samesurf-loader{0%{top:6px;height:51px}100%,50%{top:19px;height:26px}}'; if (styles.styleSheet) { styles.styleSheet.cssText = css } else { styles.appendChild(document.createTextNode(css)) } document.getElementsByTagName('head')[0].appendChild(styles); this.styles = styles } };; SameSurf.prototype.createIframe = function (url) { var iframe = document.createElement('iframe'); iframe.id = 'sameSurfIframe'; iframe.frameBorder = '0'; iframe.style.position = 'fixed'; iframe.style.top = '0px'; iframe.style.right = '0px'; iframe.style.bottom = '0px'; iframe.style.left = '0px'; iframe.style.zIndex = '9999'; iframe.width = '100%'; iframe.height = '100%'; iframe.setAttribute('src', url); document.getElementsByTagName('body')[0].appendChild(iframe); this.iframe = iframe };; SameSurf.prototype.messageReceived = function (e) { console.log('Message Received', e); if (e.origin === 'https://realtime.samesurf.com') { var message = e.data; switch (message.type) { case 'storage_update': break; case 'user_gone': break; case 'user_logout': this.coBrowseEnd(); break } } else { console.warn('Message response from unapproved source') } };; SameSurf.prototype.pageLoaded = function () { document.getElementById('coBrowseStart').addEventListener('click', this.coBrowseStart.bind(this), false); document.getElementById('testMessaging').addEventListener('click', function () { window.parent.postMessage('Hello World', window.location.origin) }, false); window.addEventListener('message', this.messageReceived.bind(this), false) };; return SameSurf }()); new SameSurf();
//# sourceMappingURL=samesurf.js.map
